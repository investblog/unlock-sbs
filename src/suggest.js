const ICON_LOCKED_DATA_URL = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMzAuODQ1IDU1LjQ1M2MtLjkwOC0uMTUyLTEuODMtLjI2Mi0yLjczMS0uNDY0LTEuODk2LS40MjctMy43NzQtLjkzNS01LjY3Mi0xLjM0OC0xLjIyNS0uMjY2LTIuNDctLjQzMy0zLjcxMy0uNjE1LS4xOTYtLjAyOS0uNDMxLjA2Ny0uNjIxLjE2MS01LjMyNCAyLjYyOC0xMC42NDMgNS4yNjMtMTUuOTYzIDcuODk2LS4wNzMuMDM2LS4xNDcuMDY1LS4yMi4wOTdsLS4wODQtLjExNyAxMi44MjYtMTAuOTA2LS4wMDItLjA4My0xMy45NzEgMy4wMmMuNjM0LS4zMzUgMS4zMDktLjY5NCAxLjk4NC0xLjA1YTM0MiAzNDIgMCAwIDAgMjMuMjctMTMuNDQyYzIuNDMtMS41MzUgNC44NzUtMy4wNyA2Ljk3LTUuMDU4IDEuMzc4LTEuMzA3IDIuNjY3LTIuNzEgMy45NS00LjExMiAxLjI1NS0xLjM3NiAyLjUxOC0yLjczOCA0LjI0NS0zLjUyNyAyLjg0OC0xLjMwMyA1LjYzNi0xLjA0IDguMzQuNDQzLjU5My4zMjYgMS4xMDUuODAzIDEuNzA3IDEuMTEuNjIyLjMxNyAxLjMuNTMgMS45NjUuNzU0LjgyLjI3NyAxLjY1NC41MTcgMi41MjMuNzg1LS43NDMuNjc2LTEuNDU2IDEuMzMtMi4xNzUgMS45NzUtMS45ODggMS43ODctMi44ODggNC4wNDMtMi45ODIgNi42ODYtLjE0IDMuOTMyLTEuMDY0IDcuNjQtMy40MDUgMTAuODgtMi40MjMgMy4zNTMtNS42OTUgNS40NzUtOS43MDQgNi40Mi0xLjM3NS4zMjQtMi43OTUuNDUzLTQuMjQuNjc4djUuOTEyYzIuMTYtLjE0MyA0LjA1My0uOTE4IDUuNzQ2LTIuMjIzIDEuNDI0LTEuMDk5IDIuNTktMi40MzggMy42NjYtMy44NjYuMTM5LS4xODMuMzE5LS4zNDUuNTA3LS40NzggMS4yNTgtLjg4NiAyLjUyMy0xLjc2IDMuNy0yLjU3OS0uMTUyIDEuMDE5LTIuNjQyIDQuNzg4LTQuOTAxIDcuMzA2IDMuMzg0LS42NDMgMTAuNjAzLTUuODU1IDEzLjAyLTkuNDE1LTEuNDgtMS4wNjQtMy4xMzYtMS43My00Ljg5LTIuMjMybDEuMDczLTJjMS44MjkuNjA4IDMuNjQgMS4zMzQgNS4yNDEgMi40NjMgMi4wODYtMy4wNjIgMy41MTYtNi40MDcgNC4zNTMtMTBhMjUuNiAyNS42IDAgMCAwIC42NzYtNS40N0g1NC43N2wtLjA3LS4xMDNxLjc0NC0uNjc0IDEuNDkxLTEuMzQzYy4xLS4wODguMjE2LS4xNTcuMzE2LS4yNDQuNTEyLS40NDYgMS4wNzQtLjY1OCAxLjc4Mi0uNjEyLjk5LjA2MyAxLjk4Ny4wMTYgMy4wNDguMDE2LS4xNy01LjkzNi0yLjAyMS0xMS4yNjctNS4zNzItMTYuMTA1LTIuMTQgMS4xNjYtNC4zOSAxLjk0LTYuNjcgMi42MjdsMS40NzYgNi42ODVjLS44NzItLjM2LTEuNjE4LS42NTMtMi4zNDYtLjk4NS0uMTIyLS4wNTUtLjItLjI3NC0uMjQtLjQzMS0uMzc4LTEuNTE1LS43NDItMy4wMzMtMS4xMTQtNC41NS0uMDE3LS4wNjgtLjA2NC0uMTMtLjA5Ni0uMTk0LTQuNTQ4IDEuMDI2LTkuMTU2IDEuNDI0LTEzLjg2NSAxLjUwMnYuNDcxYzAgMy41MjQtLjAwNCA3LjA0Ny4wMDcgMTAuNTcuMDAxLjMxMi0uMDkuNTIzLS4zMi43MjYtLjY0OC41NjgtMS4yNjcgMS4xNjgtMS45MiAxLjczYS45Ny45NyAwIDAgMS0uNTg2LjIxcS02LjMxLjAyLTEyLjYyMS4wMDljLS4yOTQgMC0uNDguMDQyLS42MDcuMzU3LS4yOTUuNzMtLjgzNyAxLjI1Ni0xLjU1MyAxLjU4LS4yMzQuMTA1LS4yODMuMjMtLjI3NS40NjguMDcgMi4xMzYuMjggNC4yNTUuNzMzIDYuMzQ1LjA1Ni4yNi4wMDguNDMtLjI1LjU3My0uNTU3LjMwNC0xLjA5Mi42NDYtMS42ODMgMS4wMDItLjcyNy0yLjcyMi0uOTg2LTUuNDY2LTEuMTEyLTguMjQ0LS45NDMtLjI5NS0xLjU3My0uOTQxLTIuMDAxLTEuODItLjA1Ni0uMTE0LS4yMjctLjI0Ny0uMzQ1LS4yNDctMi42MTYtLjAxMi01LjIzMy0uMDA2LTcuODQ5LS4wMDItLjAyNiAwLS4wNTIuMDIyLS4xMTIuMDQ4LjIxIDUuMTcgMS42ODMgOS45NjUgNC40IDE0LjQyM2wtMi4xMTEgMS4wOGMtLjUxMS0uOTgyLTEuMDMzLTEuOTIxLTEuNDk4LTIuODg4YTMxLjYgMzEuNiAwIDAgMS0zLjA1MS0xNi4xNmMuMzk1LTUuMzMyIDEuOTQzLTEwLjI5MyA0Ljg1MS0xNC43OEM5Ljg5NyA3LjUyOCAxNi40MiAyLjgyMyAyNC44NTIuODJhMzAgMzAgMCAwIDEgOC43ODItLjc2NmM2LjYyLjM5NSAxMi42MTMgMi41NTcgMTcuODcgNi42NDYgNS43NjQgNC40ODUgOS41NDEgMTAuMjgzIDExLjM0NyAxNy4zNTQuNDk3IDEuOTUuNzk4IDMuOTQzLjg0MyA1Ljk2LjAzMyAxLjQ1My4wODIgMi45MTMtLjAxNyA0LjM2MS0uMTk0IDIuODEyLS44MjQgNS41NDMtMS43NzYgOC4xOTYtMS43NTQgNC44ODUtNC41NjIgOS4wNzItOC4zNDUgMTIuNjE4LTQuMTY1IDMuOTA0LTguOTg1IDYuNTk5LTE0LjU1IDcuOTM4LTIuNzU0LjY2Mi01LjU0My45ODMtOC4zNjkuODM5LTYuMTY4LS4zMTUtMTEuNzY3LTIuMjgtMTYuNzc2LTUuOTA1bC0uMzE0LS4yMjhjLjgwMS0uMzcgMS41NzctLjc0MiAyLjM2Ny0xLjA3OS4xLS4wNDIuMjkyLjA4MS40MTguMTY0IDIuMjI3IDEuNDUyIDQuNTk1IDIuNjAzIDcuMjQ3IDMuNGEyMS41IDIxLjUgMCAwIDEtMy45MDgtNC45NjJjLjkyNi4xNDQgMS43OC4yNjQgMi42My40MThhLjguOCAwIDAgMSAuNDQ2LjI4OGMxLjM2MiAxLjc0NCAyLjg3MiAzLjMyIDQuODUxIDQuMzc5YTEwIDEwIDAgMCAwIDMuMjQ3IDEuMDY0em0uMDAzLTM2LjEzNWMtNC42OS0uMDk0LTkuMzAyLS40OTYtMTMuOTI4LTEuNTU2LS40MzcgMi4wNjUtLjkxMSA0LjA0NS0xLjI1OSA2LjA0Ny0uMjUgMS40NC0uMzI3IDIuOTEtLjQ4OSA0LjM2Ny0uMDMuMjc2LjA3NS40MDMuMzMxLjUyMmEyLjkgMi45IDAgMCAxIDEuNTU0IDEuNjg3Yy4xMDcuMjk1LjI2LjM4Ny41NzcuMzg2IDMuMzMtLjAxOCA2LjY2LS4wMTggOS45OS0uMDIyaDMuMjI0ek0yLjU5IDMwLjY5N2MuMDcuMDQ2LjA4My4wNjEuMDk0LjA2MSAyLjY0NC4wMDYgNS4yODguMDEzIDcuOTMyLjAwNi4wOTIgMCAuMjMyLS4xMi4yNjgtLjIxNi4zNDgtLjkwMS45NDQtMS41NTcgMS44My0xLjk1M2EuNDYuNDYgMCAwIDAgLjIyLS4zMTVjLjA1LS40Ny4wNC0uOTUuMS0xLjQxOS4yMTUtMS42NTUuMzk2LTMuMzE2LjY5MS00Ljk1Ny4yNzktMS41NDYuNjg0LTMuMDY5IDEuMDM2LTQuNjEyLTIuMjczLS42Ny00LjU1NS0xLjM5OS02LjcyMy0yLjU0NS0zLjMyOCA0LjgwOC01LjE0NyAxMC4xMTctNS40NSAxNS45NXptMzAuNTQtMTMuNjQyYzIuMjQtLjE0NyA0LjQzNS0uMjM2IDYuNjE3LS40NDggMi4xODgtLjIxMiA0LjM2NC0uNTQ2IDYuNTczLS44My0uMDM2LS4xNjUtLjA0My0uMjM3LS4wNjgtLjMwMy0xLjM1Mi0zLjQ2My0zLjEzMy02LjY2MS01LjczOS05LjM1OC0yLjAxOC0yLjA5LTQuNDI0LTMuMzU2LTcuMzgyLTMuNTQ2djE0LjQ4NG0tMTUuNDctMS41MDRjMi4xMzIuNzMgMTEuNTAxIDEuNjgyIDEzLjE4MiAxLjM2NlYyLjU0NWMtLjE2NS4wMjctLjI5NS4wNTgtLjQyNy4wNy0yLjEzLjE4NC0zLjk4OCAxLjAxNy01LjYyIDIuMzc1LTIuMDIgMS42OC0zLjYxOCAzLjcxNS00Ljg3NCA2LjAwNy0uODEgMS40OC0xLjUwNyAzLjAyNC0yLjI2MSA0LjU1M20xNi40MTggMjAuODAyIDcuODc2IDUuMTE0Yy0uMDEyLjAzMi0uMDE1LjA2NS0uMDM0LjA4Ni0xLjM3OCAxLjU1Ni0yLjc1NSAzLjExNS00LjE0IDQuNjY0YS43LjcgMCAwIDEtLjM3Mi4xOTZjLTEuNDQxLjI0Ni0yLjg4NS40OC00LjMyOC43MTNsLTYuMyAxLjAxM3EtMi45NTIuNDc1LTUuOTA0Ljk1NmMtLjUzMi4wODYtMS4wNjMuMTgzLTEuNTk0LjI3NS40MjYuMDkyLjgzOS4xMjMgMS4yNS4xNjkgMS4yMDkuMTMxIDIuNDE3LjI1MyAzLjYyMS40MDcgMS41Ny4yIDMuMTE3LjM2IDQuNzEzLjA0NyAyLjkzOS0uNTc5IDUuOTAzLTEuMDMyIDguODYtMS41MjUuNDM2LS4wNzQuNzgyLS4yMzEgMS4wOTQtLjU3IDEuMjktMS4zOTkgMi42MTQtMi43NjQgMy45MTQtNC4xNTMuODMtLjg4NSAxLjYzOS0xLjc5IDIuNDU3LTIuNjg1LS4wNTktLjA1Ni0uMDc4LS4wOC0uMTAzLS4wOTctMy4wMTgtMS45ODItNi4wMzYtMy45NjUtOS4wNjMtNS45MzMtLjA5OC0uMDY0LS4zNC0uMDIzLS40NDUuMDU5LS41LjM5MS0uOTc0LjgxNS0xLjUwMyAxLjI2NnpNOS40OTYgMTIuOTAzYzEuNDA0LjgwMiA0LjA4MyAxLjc2NyA2LjAyNSAyLjE3MiAxLjU2Ny00LjA3NyAzLjY0LTcuODQ4IDYuODMtMTAuOTI3LTUuMTQ2IDEuNjY4LTkuMzc4IDQuNjUxLTEyLjg1NSA4Ljc1NG0zMi4yNDYtOC43NjRjLjg2NSAxLjAwOCAxLjc3IDEuOTcyIDIuNTcgMy4wMTUgMS43NjcgMi4zIDMuMDQ3IDQuODcyIDQuMDYgNy41OC4xMTYuMzA2LjIyNy40MTQuNTcuMjkzIDEuMTUxLS40MDQgMi4zMjctLjc0MSAzLjQ3LTEuMTY4LjcwNi0uMjY0IDEuMzY5LS42NDYgMi4xMDgtMS4wMDItMy41NTUtNC4xMTItNy43ODItNi45OTYtMTIuNzc4LTguNzJ6TTQ2IDMyLjE0M2MuODEzLjAxIDEuNTQ3LS43MDYgMS41NTMtMS41MTQuMDA2LS43OTktLjY4Ni0xLjUwNS0xLjQ4OS0xLjUyLS44OTItLjAxNS0xLjU3My42MzMtMS41ODEgMS41MDRBMS41MSAxLjUxIDAgMCAwIDQ2IDMyLjE0MiIgZmlsbD0iY3VycmVudENvbG9yIi8+PC9zdmc+';
const ICON_UNLOCKED_DATA_URL = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNNDUuNTk3IDU1LjI1Yy0xLjgyNi43NzEtMy41NTUuNTAxLTUuMTk0LS42MDItMS41MTYtMS4wMjEtMi41MzgtMi40NjQtMy40MjctNC4wMTYtLjQ5Ny0uODY2LS45NjYtMS43NDgtMS40OS0yLjY5OSAxLjA3IDMuOTI3IDIuNDQgNy42MzYgNC42OTUgMTEuMDA0LTMuMjk3LS40MDItNC41MTMtMS4zODUtNS43NTYtNC44MzEuMDMyLjQzLjAzMi44NjYuMSAxLjI5Mi4zMzYgMi4wODItLjQ3MiAzLjc4Ny0xLjczMiA1LjM0Ny0uMjUuMzA5LS41MDkuNjA5LS43ODIuOTM1LS45ODMtMS4wMzgtMS44MjYtMi4xNDUtMi4zNDUtMy40NjgtLjUzLTEuMzUyLS4yMDctMi43NDMtLjE3LTQuMTQ5LS44MDMgMi44OTUtMi41MiA0LjY5NS01LjcwNiA0LjgyOCAyLjE1Ny0zLjQwNyAzLjY5OC03LjA2MiA0LjcwNC0xMC45NDktLjI0NS40NzYtLjQ2Mi45NjktLjc0IDEuNDI0LS43MDUgMS4xNTItMS4zNjEgMi4zNDYtMi4xNzggMy40MTUtLjk2MyAxLjI2LTIuMTQ0IDIuMjk4LTMuNzU1IDIuNzI0LTEuMTk5LjMxNy0yLjM0My4yMDQtMy41MDItLjI4IDMuNTU0LTMuNjQ2IDYuMTk1LTcuOTQgOS4wMzctMTIuMTA3LTEuMTYtMS43NjQtMi4wMTktMy42NjMtMi40ODMtNS43MjQtLjQ2LTIuMDQyLS43NDMtNC4xMDctLjc2LTYuMjItLjA0Ny4yMTYtLjEwNC40My0uMTQuNjQ5LS4zMzYgMi4wMzMtLjIzIDQuMDgyLS4yMDEgNi4xMjguMDAyLjEzLS4wNTEuMzAyLS4xNDIuMzg3LTEuMjQ2IDEuMTU3LTIuNzAyIDEuNzctNC40MjIgMS42MDYtLjU5NC0uMDU3LTEuMTgtLjIxLTEuNzg0LS4zOCAxLjE5OC0xLjI0NCAyLjQ1LTIuMzk3IDMuMTkyLTMuODgtLjY4Ny41NS0xLjM5MyAxLjE3NC0yLjE2MSAxLjcxLTEuMDQuNzI0LTIuMjEgMS4wOTgtMy40OTIuOTk3LS43NTUtLjA2LTEuNDQ2LS4zMzMtMi4xMzctLjc3IDEuOTM1LTEuMzA2IDMuNTQ3LTIuOTQzIDUuMTIzLTQuNjNxLS40MDYuMjcxLS44MTcuNTM4Yy0xLjExNy43Mi0yLjIzNiAxLjQzLTMuNTMzIDEuODAyLTEuNzE5LjQ5My0zLjMzNy4zMzEtNC44MzMtLjY5NWEyLjMgMi4zIDAgMCAxLS4yNy0uMjIzYy0uMDc0LS4wNy0uMTM4LS4xNS0uMTcxLS4xODhsNi4zNC0zLjQyOC0uMDYyLS4xMjhjLS4xNy4wNjgtLjMzNi4xMzktLjUwNi4yMDMtMS4yNzYuNDc5LTIuNTcxLjkwNy0zLjkzMiAxLjAzMy0xLjg0My4xNy0zLjU3NC0uMTI0LTQuOTI2LTEuNTM2LS4zMDgtLjMyMS0uNTI2LS43MjktLjg1LTEuMTkgMi40NjgtLjMyIDQuNzk3LS43NTIgNy4wNjktMS40NjYtLjkzMyAwLTEuODY5LjA1My0yLjc5Ni0uMDEzLTEuNDE2LS4xLTIuODI1LS4zMS00LjEzNi0uODk4LTEuNTItLjY4Mi0yLjUyOS0xLjgzMy0yLjk5My0zLjQ0NGEyIDIgMCAwIDEtLjA1Mi0uMjM3Yy0uMDA1LS4wMy4wMTUtLjA2NS4wMjYtLjEwNCAyLjc4Ni41MjIgNS41NjYgMS4wNDQgOC40MzYgMS4wNzItLjYyNS0uMTU1LTEuMjMzLS4yODUtMS44My0uNDU3LTIuMDctLjU5OC00LjAyLTEuNDY0LTUuNzcyLTIuNzI5Qy45ODUgMTkuOTIyLjIzOCAxOC41NTkuMDA5IDE2LjkxYy0uMDE5LS4xMzgtLjAwMy0uMjgtLjAwMy0uNDc3IDIuNzgzIDEuMzg5IDUuNjE2IDIuNTU4IDguNTcgMy40NjctLjc3Ny0uNDY3LTEuNTUtLjkwOS0yLjMtMS4zODUtMS45NjgtMS4yNS0zLjY2Mi0yLjc4OC00Ljg5OS00Ljc4Ni0uODk5LTEuNDUzLTEuMDg1LTMuMDI0LS43NC00LjY3Ni4wMDMtLjAxOC4wMjctLjAzMi4wNi0uMDcgMi40ODcgMi43NzcgNS4yODUgNS4xNzUgOC41NTIgNy4wMDUtLjA5Ni0uMDgtLjE5NS0uMTU4LS4yODYtLjI0NC0yLjAyNS0xLjkxNC0zLjg0LTMuOTk2LTUuMTM5LTYuNDg0LS42MDItMS4xNTEtLjk5OC0yLjM1NS0uODc2LTMuNjg4LjA5NS0xLjAzOC40MjQtMS45NjcgMS4xMzgtMi44MDIuMDg2LjE2OS4xNi4zMDcuMjI3LjQ0NiAxLjEgMi4yMzMgMi41NiA0LjIyOCA0LjA2NSA2LjE5NCAyLjU1NCAzLjMzNyA1LjQ1MyA2LjM2IDguNDMzIDkuMzA5IDEuNDk5IDEuNDgzIDIuOTUgMy4wMTUgNC40NiA0LjQ4NSAxLjE0OCAxLjExNyAyLjM1NyAyLjE3MyAzLjU5MyAzLjMwNi4yMzUtLjcxMy40NjYtMS4zNC42NDgtMS45OC4zMjItMS4xMzcuNi0yLjI4Ny45MjItMy40MjUuNzA4LTIuNDk0IDIuNDc0LTMuODEyIDQuOTM4LTQuMTkzIDEuNTgzLS4yNDQgMyAuMzggNC4yOCAxLjI4OCAxLjIwMS44NTIgMS42NzcgMi4xMjcgMi4wMjkgMy40ODUuNDA5IDEuNTguODYgMy4xNSAxLjMxOCA0LjgxOS41LS40MjYuOTI1LS43NSAxLjMxLTEuMTE3IDEuNzk2LTEuNzE0IDMuNjAxLTMuNDE4IDUuMzY4LTUuMTYzIDEuODY3LTEuODQ0IDMuNzQtMy42ODQgNS41MjItNS42MSAxLjQxMi0xLjUyNyAyLjcxMi0zLjE1OSA0LjAyLTQuNzc5IDEuNTQ4LTEuOTE4IDIuOTk0LTMuOTEgNC4xNDgtNi4wOTcuMTY0LS4zMS4zMjYtLjYyLjUwNi0uOTY0LjU2My43NjYuOTI3IDEuNTc1IDEuMDgzIDIuNTA5LjI4MiAxLjY4LS4zMyAzLjExLTEuMTIgNC41MS0xLjI1NCAyLjIyLTIuOTI4IDQuMTA0LTQuNzQ1IDUuODcyLS4wNDEuMDQtLjA5Ni4wNjYtLjExNi4xMzEgMy4xNTgtMS43OCA1Ljg2OC00LjEwMiA4LjI4MS02Ljg0My4yNTEuNjk0LjIzOCAxLjM3My4xOTMgMi4wNi0uMTIgMS44Mi0xLjEwOCAzLjIwNy0yLjI0NiA0LjUxNS0xLjU2NyAxLjgtMy41MzcgMy4wNjQtNS42MjQgNC4xNjZhMiAyIDAgMCAwLS4yOTQuMTgxYzIuOTg0LS44NTYgNS44MjQtMi4wNzQgOC42MDktMy40MzJsLjEwNi4wNDVjLS4wNjkuNDI0LS4xMDYuODU1LS4yMTMgMS4yNjktLjQzNiAxLjY4MS0xLjUyMyAyLjg2My0yLjk3NSAzLjczLTEuOTM5IDEuMTU2LTQgMi4wMi02LjIyMiAyLjQ2OC0uMTg3LjAzOC0uMzc0LjA3LS41NTkuMTE4IDIuODctLjAxNyA1LjY3Ny0uNTM1IDguNTYyLTEuMDg4LS4wODMuMjc4LS4xMzcuNTE4LS4yMjUuNzQ1LS43MzIgMS44NzUtMi4xNDQgMi45NjUtNC4wNDUgMy40ODYtMS42MTMuNDQxLTMuMjYuNTU2LTQuOTI0LjUwNy0uNDA3LS4wMTItLjgxNC0uMDAyLTEuMTUtLjAwMiAyLjMzLjY1OCA0Ljc4NCAxLjEyIDcuMzA4IDEuNDMzLS4yOTQuODAyLS44MDEgMS4zNjQtMS40MzcgMS44MTUtLjg5LjYzMi0xLjkuOTA2LTIuOTgyLjk1OC0xLjg3Mi4wOS0zLjYxMi0uNDQyLTUuMzI2LTEuMTAzcS0uMTEzLS4wNDctLjIyNy0uMDg3Yy0uMDE5LS4wMDUtLjA0My4wMS0uMTEuMDk5bDYuMjU5IDMuMzk3Yy0uMjIyLjE3NS0uNDY1LjQwMi0uNzQuNTc2LTEuNDg2Ljk0My0zLjA2My45NjUtNC43LjQ1Ny0xLjQ1Ny0uNDUzLTIuNzA4LTEuMjgzLTMuOTY2LTIuMTA2LS4wNTUtLjAzNS0uMTEtLjA3Mi0uMjEzLS4wNTYuMzg4LjQwNi43NjguODIgMS4xNjYgMS4yMTZxLjU5OS41OTIgMS4yMjQgMS4xNTdhMzEgMzEgMCAwIDAgMS4zIDEuMTI3Yy40MzUuMzUxLjg5Mi42NzUgMS4zNDIgMS4wMTQtMS4wNzMuODAyLTIuNjI3IDEuMDE3LTQuMDIyLjUzMS0xLjMzNy0uNDY2LTIuNDQtMS4zMDctMy40Ny0yLjI1Mi0uMTA3LS4wOTgtLjE3Ni0uMjM4LS4yNjQtLjM1OGwtLjE0NS4xMjVjLjUwMS42NzYuOTc4IDEuMzcyIDEuNTEgMi4wMjQuNTQuNjYyIDEuMTM1IDEuMjc5IDEuNzA1IDEuOTE0LS4zMzEuMDg2LS43OTkuMjU5LTEuMjguMzItMS40Ni4xODMtMi44MjgtLjA5MS00LjA2NS0uOTItLjAyOS0uMDItLjA2MS0uMDM0LS4wOS0uMDUzLS42MTctLjQwNy0uOTE3LS44OC0uODcxLTEuNzE4LjA4NC0xLjUzNi0uMDM0LTMuMDg2LS4xLTQuNjI5LS4wMi0uNDU3LS4xNDYtLjkxLS4yMi0xLjM0NS0uMDYxLjgyLS4xMSAxLjY1OC0uMTg5IDIuNDkzLS4zIDMuMTc5LTEuMDkzIDYuMjA3LTIuODA1IDguOTQtLjE5Ny4zMTUtLjE4NC41MjMuMDI4LjgyMyAxLjk3MyAyLjc5MiAzLjg5OCA1LjYxOCA1LjkwNiA4LjM4NS44NDggMS4xNjkgMS44NiAyLjIyIDIuODIgMy4zNTF6TTMxLjk2NCAyNy40NTdjLjQxNi0xLjEyNiAxLjMyNS0xLjY0NSAyLjMzNy0yLjE0M2wtMi4zMDgtMi4wNDNjLS40MDguMzUtLjc5NC42Ny0xLjE2OSAxLjAwMy0uMzguMzM4LS43NDcuNjg5LTEuMTQyIDEuMDU0Ljk4NS40OTQgMS44NyAxLjAwNiAyLjI4MiAyLjEyOW0tMi44OTQtMy4zNTRjLjIyOS0uNzYyLS43NTUtMi4wNjYtMS40MTYtMi4yMTgtLjMwNi41NC0uMzIgMS4wOS4wMjcgMS42MDcuMzIuNDc0Ljc3MS43MyAxLjM5LjYxbTUuODM3LS4wMDVjLjYzLjE2IDEuMjE3LS4yOCAxLjQzLS43M3EuMzUyLS43MzguMDEzLTEuNTAzYy0uOTcyLjQ2NS0xLjU4NCAxLjQyNC0xLjQ0MyAyLjIzM20tMi45IDI1LjM0NGMtLjIzMSAxLjkzLS40MTMgMy44NjItLjAxMiA1Ljc5NC40NDMtMS45My4yNTMtMy44NjIuMDEyLTUuNzk0IiBmaWxsPSJjdXJyZW50Q29sb3IiLz48cGF0aCBkPSJNNDAuMDQgNS41MTNjLjQ2NC43NDguOTUzIDEuNDgyIDEuMzg2IDIuMjQ3YTMyLjUgMzIuNSAwIDAgMSAzLjY0IDkuODMyLjUuNSAwIDAgMCAuMDMuMWMuMTQzLjM1Ny4wNTcuNjMtLjI2My44NTgtLjI1My4xODEtLjQ3NC40MDktLjcxNy42MjQtLjUyNy0yLjU2Ni0xLjEyLTUuMDkyLTIuMTUzLTcuNDg5LS44Ni0xLjk5Ny0xLjg0LTMuOTMzLTMuMTk2LTUuNjQ1YTUuNyA1LjcgMCAwIDAtMS4zMjctMS4yM2MtLjM5MS0uMjUzLS45MDctLjMyMi0xLjM3My0uNDUtLjk2My0uMjYyLTEuOTQ3LS4zNjItMi45NDItLjM2LS4xMTQgMC0uMjI4LjAxLS4zOTMuMDE4djExLjA3NWgtMS40NDRWMy45NzZjLS43NDQuMDQ2LTEuNDQxLjA3MS0yLjEzMy4xNC0uNDM4LjA0NC0uODY2LjE4My0xLjMwMy4yMy0uOTEzLjA5OC0xLjU3Mi42MjUtMi4xNDIgMS4yNjctMS4zMzUgMS41MDYtMi4zIDMuMjUtMy4xMyA1LjA3LS4zNy44MTItLjY3NyAxLjY1My0uOTk4IDIuNDg2LS4wMzMuMDg1IDAgLjI0Ny4wNjQuMzA5LjUzOS41Mi43NjIgMS4xMjkuNTc3IDEuODctLjE5NC43NzQtLjcyNiAxLjIwOC0xLjQ2OCAxLjM3Ni0uMjIyLjA1LS4yNzYuMTI5LS4zMi4zMjEtLjE1NS43MDEtLjMzIDEuMzk5LS41MDUgMi4xMjgtLjMyOC0uMjk1LS42NTctLjU3MS0uOTU4LS44NzQtLjA2OS0uMDY4LS4wNy0uMjMzLS4wNTUtLjM0OHEuMDQyLS4zMjguMTM3LS42NDZjLjE1My0uNTA1LjE2OC0uOTA0LS4yODEtMS4zNTItLjQ4Ny0uNDg2LS40ODMtMS4xOTYtLjIwOC0xLjg0LjI3LS42MzcuNzY0LTEuMDI4IDEuNDY0LTEuMDkuMjMtLjAyMS4yOTItLjE0MS4zNTItLjMxMS44MTEtMi4yNjUgMS44NS00LjQyIDMuMTc1LTYuNDMuMTYzLS4yNS4zMzEtLjQ5NS41NDEtLjgwOC00LjE2NCAxLjUwMi03LjgzIDMuNjQxLTEwLjg1NSA2Ljc4OGwtMS4xOC0xLjE1OEMyMi44ODUtLjU5OCA0MS4wNC0uNjA2IDUxLjg3NSAxMS4wNjhsLTEuMDk3IDEuMjY2QzQ3LjQ4IDguOTkgNDIuODY4IDYuMDY3IDQwLjA0MyA1LjUxem01LjkwNSA0MC40LTIuMDM1IDQuOTYxYy0uMzMyLS40MDItLjYwMi0uNzA0LS44MzYtMS4wMy0uMDUzLS4wNzQtLjAxLS4yNDQuMDMzLS4zNTMuNDQzLTEuMTQ3Ljg5NS0yLjI5IDEuMzQ0LTMuNDM1LjAzLS4wNzUuMDQ3LS4xNTQuMDg5LS4yOTMtLjQ4Ni0uMDY4LS45NTEtLjE2LTEuNDItLjE5Mi0uOTU1LS4wNjYtMS45MTItLjA5Ny0yLjg2OS0uMTUxLS4wOTEtLjAwNS0uMjE1LS4wNTEtLjI2My0uMTItLjMwMi0uNDI2LS41ODYtLjg2NS0uOTQyLTEuMzk4bDUuODc2LjUyOGMuMTg2LS44MDQuMzg1LTEuNjEyLjU1Mi0yLjQyNy4wNTctLjI3NC4xMjMtLjQ2My40NDItLjUxLjMyLS4wNS42MjktLjE2IDEuMDQyLS4yNjhsLS43MjcgMy4zNzFjMi4yMTIuNTEgNC40MzEgMS4wMSA2LjY0MSAxLjU0My4zNC4wODIuNS4wMzMuNy0uMjUzIDEuNTk1LTIuMjg4IDIuODgyLTQuNzI2IDMuNjc1LTcuNDExYTMwIDMwIDAgMCAwIC45NjUtNC43NDRjLjAxMi0uMDk4LjEyMS0uMjA3LjIxMy0uMjY3LjQ2Ny0uMzA2Ljk0NC0uNTk5IDEuNDk2LS45NDQtLjE4IDQuNDc5LTEuNDE3IDguNjEyLTMuNjI2IDEyLjQ0My0yLjIyNiAzLjg2My01LjMyMiA2LjkzLTguOTk2IDkuNDU0bC0xLjE3OC0xLjEwNGMyLjM0Mi0xLjc0NiA0LjUxNi0zLjY2NSA2LjQ1LTUuOTlsLTYuNjI3LTEuNDEyek0xNy43OTQgNDQuN2wtLjc4NS0zLjQ2M2MuNDg2LjEyNS44OC4yMTYgMS4yNjUuMzMzLjA2OS4wMjEuMTMuMTQzLjE1My4yMjguMjEuNzk4LjQyIDEuNTk0LjYwNSAyLjM5Ny4wNTMuMjI2LjE0Ny4yNzcuMzYuMjUyLjk1LS4xMTYgMS45LS4yMzMgMi44NTItLjMyMi44Ni0uMDggMS43MjMtLjEyNiAyLjY1LS4xOS0uMzE0LjQ5OC0uNTkuOTUzLS44ODkgMS4zOTItLjA0Ny4wNy0uMjAxLjA4NS0uMzA4LjA5My0xLjMyNy4xLTIuNjU1LjE5My0zLjk4MS4yOTEtLjA3Ny4wMDYtLjE1Mi4wNDItLjI3Ni4wNzkuMjguNzcxLjU0MiAxLjUyMy44MjYgMi4yNjguMTkuNDk5LjQyLjk4My42MTIgMS40ODEuMDM3LjA5Ni4wMjUuMjU4LS4wMzUuMzM2LS4yMzUuMzAzLS40OTkuNTg2LS44MjMuOTU3TDE4LjA4IDQ1LjljLTIuMTIuNDUtNC4zMDMuOTE2LTYuNDg2IDEuMzhsLS4wMTkuMTMyYzEuNzkzIDIuMjUgMy45NzcgNC4wODggNi4yMzUgNS44NjItLjM4OC4zNjktLjc2MS43Mi0xLjE1OSAxLjA5OC0zLjQ1OC0yLjI2OS02LjI5OC01LjI0Mi04LjUxLTguNzkyLTIuNDc2LTMuOTczLTMuNzc2LTguMzMzLTQuMDUtMTMuMDUuNTc2LjM1NCAxLjEwMi42NzIgMS42MiAxLjAwMi4wNjIuMDQuMTEuMTQ1LjExOC4yMjQuMzMxIDMuMTQ2IDEuMTg3IDYuMTQgMi42ODggOC45MjUuNjEyIDEuMTM3IDEuMzYzIDIuMTk5IDIuMDQgMy4zLjEzLjIxLjI1NS4yMTguNDg2LjE2NSAyLjEyOC0uNDg2IDQuMjYxLS45NSA2LjM5My0xLjQxOS4xLS4wMjIuMjA3LS4wMTYuMzU4LS4wMjciIGZpbGw9IiMwMDAiLz48L3N2Zz4=';
function _(id, fallback=''){ try { return chrome.i18n.getMessage(id) || fallback; } catch(e){ return fallback; } }

function parseHash() {
  if (!location.hash) {
    try {
      chrome.storage.local.get('__ah_sidepanel_params', (v) => {
        const raw = v && v.__ah_sidepanel_params || '';
        if (raw) { history.replaceState(null, '', raw); location.reload(); }
      });
    } catch(e){}
  }
  const h = location.hash.slice(1);
  const params = new URLSearchParams(h);
  return { url: params.get('u') || '', err: params.get('e') || '' };
}

function hostname(url) {
  try { return new URL(url).hostname.replace(/^www\./i, ''); } catch { return ''; }
}

function setStateIndicator(hasTips) {
  const row = document.getElementById('stateRow');
  const icon = document.getElementById('stateIcon');
  const text = document.getElementById('stateText');
  if (!row || !icon || !text) return;
  const unlocked = !!hasTips;
  row.classList.toggle('state-ok', unlocked);
  row.classList.toggle('state-wait', !unlocked);
  const dataUrl = unlocked ? ICON_UNLOCKED_DATA_URL : ICON_LOCKED_DATA_URL;
  if (dataUrl) { icon.src = dataUrl; }
  else { icon.removeAttribute('src'); }
  text.textContent = unlocked ? _('stateUnlocked','Tips ready') : _('stateLocked','Waiting for tips');
}

function buildLink(href, text, id) {
  const a = document.createElement('a');
  a.className = 'btn';
  a.href = href;
  a.textContent = text;
  if (id) a.id = id;
  a.target = '_blank';
  a.rel = 'noreferrer';
  return a;
}

async function loadAlternates(domain) {
  return new Promise((resolve) => {
    chrome.storage.sync.get({ alternates: {} }, (data) => {
      const map = data.alternates || {};
      const alts = map[domain] || map[domain.replace(/^www\./, '')] || [];
      resolve(Array.isArray(alts) ? alts : []);
    });
  });
}

(async function main() {
  const { url, err } = parseHash();
  const domain = hostname(url);
  setStateIndicator(false);
  document.getElementById('meta').textContent = `${_('labelURL','URL')}: ${url} · ${_('labelError','Error')}: ${err || _('labelUnknown','unknown')}`;

  const quick = document.getElementById('quick');
  try {
    const u = new URL(url);
    const toggledProtocol = u.protocol === 'https:' ? 'http:' : 'https:';
    const retryToggled = `${toggledProtocol}//${u.host}${u.pathname}${u.search}`;
    const retrySame = url;
    quick.appendChild(buildLink(retrySame, _('labelRetry','Retry')));
    quick.appendChild(buildLink(retryToggled, `${_('labelTry','Try')} ${toggledProtocol.replace(':','').toUpperCase()}`));
  } catch {}

  // Wayback scheme-less target
  const wayback = document.getElementById('wayback');
  let bare = '';
  try { const wu = new URL(url); bare = `${wu.host}${wu.pathname}${wu.search}`; }
  catch { bare = String(url).replace(/^[a-z]+:\/\//i, ''); }
  wayback.href = `https://web.archive.org/web/*/${bare}`;

  const sameDomainSearch = document.getElementById('sameDomainSearch');
  sameDomainSearch.href = domain ? `https://www.google.com/search?q=site%3A${encodeURIComponent(domain)}` : `https://www.google.com/`;

  const list = document.getElementById('alts');
  const empty = document.getElementById('alts_empty');
  const alts = domain ? (await loadAlternates(domain)) : [];
  if (!alts.length) { empty.style.display = ''; }
  else {
    alts.forEach(d => {
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.className = 'pill';
      a.href = `https://${d.replace(/^https?:\/\//,'')}`;
      a.innerHTML = `${d} <span class="arrow">⭢</span>`;
      a.target = '_blank'; a.rel = 'noreferrer';
      li.appendChild(a); list.appendChild(li);
    });
  }
  setStateIndicator(alts.length > 0);

  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    const txt = _(key, el.textContent);
    if (txt) el.textContent = txt;
  });
})();
// open settings in side panel via background
const btn = document.getElementById('openSettings');
if (btn) btn.addEventListener('click', ()=>{ try{ chrome.runtime.sendMessage({type:'ah:open-settings'});}catch(e){} });
